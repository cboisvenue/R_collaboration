{
    "collab_server" : "",
    "contents" : "#-----------------------------------------------------------\n# Building the databases for the stats analysis on Juha's\n# Stand reconstruction plots \n#\n# Read-in Brenton's MODIS info\n# Read-in the FetchClimate data\n# see how much linkages I can do\n#\n# CBoisvenue\n# ---------------------------------------------------------\n\nlibrary(data.table)\n\nmodis <- fread(\"M:/Brenton/MODIS Climate Database v11.csv\")\nfetchClim <- fread(\"M:/Brenton/Fetch Climate Canadian Dataset.csv\")\nbiomHa <- fread(\"C:/Celine/Syndocs/RES_Work/Work/StandReconstruction/work/data/plotBiomHa.csv\")\n\n# list to think/do\n# select right fetchClim pixels that the plots are in\n## August 3, 2016\n# the fetchClim data seems to have climate data back to 1943\n# there are a few instances of plots that have biomass estimates prior to 1943 (36 instances)\n# I decided that I would only go as far back as 1943 given the time it would take me to get \n# further back climate data\n# \n# Now, I need to match the locations of the plots to the 100kmX100km fetchClim tiles\n# Brenton has alread done that with to matche the plots and corresponding the MODIS pixels\n# to fetchClim data, but only for the years 2000 to 2014 (the MODIS years)\n#\n## What I have learned about the data up to now\n# there are a bunch of blanks in the MODIS Climate Database v11.csv\n# I remove them using this\nmodis <- modis[modis$Study.Name!=\"\",] \n##but before doing this, check if all columns are \n# # blank when the Study.Name is blank\n# blanks <- modis[which(modis$Study.Name==\"\"),] \n# str(blanks)\n# length(which(!is.na(blanks)))\n# # there are some non-blank columns...which? the Study.Name and Plot.ID are \"\" which are not\n# # counted as blanks (2*93702 = 187404).\n# dim(blanks)\n# #[1] 93702    66\n# # 93702*66\n# #[1] 6184332\n# length(which(!is.na(blanks)))\n# #[1] 187404\n# # 187404+5996928\n# #[1] 6184332\n\n\n# get fetch climate data for each plot ----------------------------------------\n# plot in biomHa\ndim(unique(biomHa[,.(StudyName,PlotID)]))\n#[1] 64  2\n# there are fewer plots here then in the MODIS. JM explained this: 64 plots are intensively \n# measured, but 981 plots are inventory plots for \n\n# plot cooddinates in the modis db\ndim(unique(modis[,.(Study.Name,Plot.ID)]))\n#[1] 1056    2\ndim(unique(modis[,.(Latitude,Longitude)]))\n#[1] 1055    2\n# why one less? ## two plots with the same coordinate (?)\nplotLoc <- unique(modis[,.(Study.Name,Plot.ID,Latitude,Longitude)])\n\n# trying one plot at a time ######## WORKING IN HERE ###############\n v1 <- bondsFetchClim[latmin < plotLoc$Latitude[1] & \n                     latmax > plotLoc$Latitude[1] &\n                     lonmin < plotLoc$Longitude[1] &\n                     lonmax > plotLoc$Longitude[1],.(latmin,latmax,lonmin,lonmax)]\n\n\n# get the fetchClim lines with these coordinate bounds\nv2 <- fetchClim[latmin == v1$latmin & latmax == v1$latmax &\n        lonmin == v1$lonmin & lonmax == v1$lonmax,.(Date, latmin,latmax,lonmin,lonmax,\n                                                    `FetchClimate Temp`,`FetchClimate Precip`,`FetchClimate VPD`)]\ndim(v2)\n#[1] 1104   16\n\n# playing with dates\n\nd1 <- strptime(v2$Date,format=\"%m/%d/%Y %H:%M:%S\")\nyear <- as.numeric(format(d1,\"%Y\"))\nmonth <- as.numeric(format(d1,\"%m\"))\n\n# add the StudyName and PlotID to match the biomHa \nStudyName <- rep(plotLoc$Study.Name[1],length(d1))\nPlotId <- rep(plotLoc$Plot.ID[1],length(d1))\n\nv3 <- as.data.table(cbind(StudyName,PlotId,year,month,v2))\n# add average GS temp and sd GS temp\nv4 <- v3[,.(StudyName,PlotId,year,GSavgTemp = mean(`FetchClimate Temp`,na.rm=TRUE),\n            GSavgPrecip = mean(`FetchClimate Precip`,na.rm=TRUE)GSavgVDP = mean(`FetchClimate VDP`,na.rm=TRUE),\n            ),by=.(year)]\n\n\n\nwhich(is.na(v3$`FetchClimate Precip`))\nv3[876,]\nwhich(is.na(v3$`FetchClimate VPD`))\nv3[229,]\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "created" : 1481064223267.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "622011708",
    "id" : "3EED7B71",
    "lastKnownWriteTime" : 1481066062,
    "last_content_update" : 1481066062748,
    "path" : "C:/Celine/GitHub/R_collaboration/BuildingDataBase.r",
    "project_path" : "BuildingDataBase.r",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}