{
    "collab_server" : "",
    "contents" : "---\ntitle: \"dataNotesMethods\"\nauthor: \"CBoisvenue\"\ndate: \"December 6, 2016\"\noutput: html_document\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = FALSE)\n```\n\n# Overview\n\nThis document is to keep track of progress in the analysis of Juha's stand reconstruction (SR) site. There are many databases involved and many potential analyses. The first part will give a brief overview of what I know about the data up to now (heading \"Data\"). After that, the first goal is to see if there is a relationship between NPP (or other measure of productivity) at the DF49 site and climate variables. The second goal will be to see if we can look at NPP estimated at those sites and compare it to NPP from MODIS (do years overlap?).\n\n\n# Data\n\nDatabases: modis, fetchClim, SR (multiple databases), and Landsat\n\n## MODIS and climate db\n\nBrenton Chookolingo, an undergraduate student from UBC, was hired to explore what remote sensing products were out there that could potentially be used for the stand reconstruction sites. He was also specifically tasked with building a database with climate data, MODIS NPP estimates for 3X3 pixels along with their landclassification around the SR sites. A copy of all his original work is here on w-vic-A105350 \"H:\\Celine_other\\Brenton Chookolingo\", there is a copy on a portable 1TB drive (the old white one), and there is a copy on the 8TB drive on Celine's desktop (F:\\Brenton Chookolingo). The final MODIS data base was copied to M:\\Brenton\\, and so was the FetchClimate data base he downloaded. The reason for the FethClimate, is that the MODIS data base only covers 2000-2014 values. SR sites will go furtherback, so climate data will be needed from FetchClim.\n\nfetClim has data for all of Canada (`nrow(fetchClim)` 635904 obs - 50km tiles). \n\nMODIS is only the SR locations. The FetchClimate columns are monthly averages, the MF (MoscowForestry) are 30-year monthly averages.**for now, remove the MF columns**\n\nMODIS, there are three elevations, one from NRCan, one from Juha (measured), one from MoscowForestry. I will keep the measured **Elevation from Juha**.\n\n**for now just keep the DF49 sites**\n\n\n### Problems to solve: SOLVED\n* matching the fetchClim data to the sites:\n  + the modis database Year goes from 2000-2014, the FetchClimate data goes back to 1943.\n\n```{r, eval=FALSE, echo=FALSE}\nlibrary(data.table)\n\nmodis <- fread(\"M:/Brenton/MODIS Climate Database v11.csv\")\nfetchClim <- fread(\"F:/Brenton Chookolingo/Complete Package/Climate Data/Fetch Climate/Fetch Climate Canadian Dataset.csv\")\ndim(modis)\nnames(modis)\nelevDiffs <- (modis$`Elevation Juha`-modis$`Elevation NRCAN`)\nhist(elevDiffs)\nelevDiff1 <- modis$`MF elev`-modis$`Elevation NRCAN`\nhist(elevDiff1)\nelevDiff2 <- modis$`MF elev`-modis$`Elevation Juha`\nhist(elevDiff2)\n\n\nstr(fetchClim)\nmodis1<-modis[,which(grepl(\"MF\",colnames(modis))):=NULL]\ndf49 <- modis[Study.Name==\"BCDF49\"]\n\nhead(df49)\nstr(df49)\n\n```\n\nIn the df49 data table, min latitude is `r min(df49$Latitude)`, max is `r max(df49$Latitude)`, while min and max longitude are `r min(df49$Longitude)` and `r max(df49$Longitude)` respectively. Looking at the fetchClim database (r code below), the tile that contains the df49 will be bounded by 48.79975 50.04821 in latitude and -125.74517 -121.95121 in longitude. I create a fetchDf49 database that has that one tile.\n\n```{r,eval=FALSE,echo=FALSE}\n# keeping the tile that contains DF49 only\nunique(fetchClim$latmin)\nunique(fetchClim$latmax)\nunique(fetchClim$lonmin)\nunique(fetchClim$lonmax)\n\nfetch1 <- fetchClim[latmin==48.79975]\n## for some reason I cannot select only the columns with the right \nfetch2 <- fetch1[lonmin==unique(fetch1$lonmin)[5]]\ndim(unique(fetch2))\n# why 1104 lines? 73 * 12 is 876, what years or months have extra??\n# there are 19 years with 24 months...\n# there are no exact duplicates\n\n\n# keep only columns of interest \nfetch3 <- fetch2[,.(Lat, Long, Date, latmin, latmax, lonmin, lonmax, `FetchClimate Temp`, `FetchClimate Precip`,`FetchClimate VPD`)]\n\n# add the years and months as seperate columns\ndate1=strptime(fetch3$Date, format = \"%m/%d/%Y %H:%M:%S\")\nyear=date1[[\"year\"]]+1900\nmonth=date1[[\"mon\"]]+1\n\nfetch4 <- fetch3[,.(Lat,Long,Date,year=year,month=month,latmin,latmax,lonmin,lonmax,`FetchClimate Temp`, `FetchClimate Precip`,`FetchClimate VPD`)]\n\nfetch5 <- fetch4[order(year,month),mult=\"first\"]\n\n# unique on a data.table only works on the key (?unique.data.table)\nsetkey(fetch5,year,month)\nfetchDf49 <- unique(fetch5)\n\n    ```\n\nThe fetchDf49 database covers `r datesYr` years (`r range(fetchDf49$Date)`) of daily values for temperature, precipitation and VPD with their provenance and uncertainty. In the original file, there are 19 of the 73 years that have 24 months. Based on 1995, this is due to having two different values of precipitation for that year. Since only some of those (the first values in the case of 1995) have no VDP values, and that my MODIS data only has growth season (May to October) values for temperatures, precipitation, and VPD, I kept the 1st of duplicated year-month values for each year that has two.\n\n\n## Stand Reconstruction (SR) data \n\nJuha Metsaranta collect stand mapping data on many sites over the years to apply his stand reconstruction methods. Juha provided all his data here: C:\\Celine\\Syndocs\\RES_Work\\Work\\StandReconstruction\\Juha\\data.\n\nThese data include tree-level biomass increments (in kg) (site&biomass/TreeGrowth.csv) and stand level biomass increment (site&biomass/StandGrowth_BiomassDBHHT.csv). Summing the tree-level biomasses give the stan-level biomass (ExploreSRdata.r).\n\nThis file contains plot-level biomass estimates, stand-level density measures, by year and study site (\"C:/Celine/Syndocs/RES_Work/Work/StandReconstruction/work/data/plotBiomHa.csv\"). \n\n```{r,eval=FALSE,echo=FALSE}\n\nsrTree <- fread(\"C:\\\\Celine\\\\Syndocs\\\\RES_Work\\\\Work\\\\StandReconstruction\\\\Juha\\\\data\\\\site&biomass\\\\TreeGrowth.csv\")\ntreeDf49 <- srTree[StudyName==\"BCDF49\"]\n\nsrStand <- fread(\"C:\\\\Celine\\\\Syndocs\\\\RES_Work\\\\Work\\\\StandReconstruction\\\\Juha\\\\data\\\\site&biomass\\\\StandGrowth_BiomassDBHHT.csv\")\n\nplotDF49 <- fread(\"C:\\\\Celine\\\\Syndocs\\\\RES_Work\\\\Work\\\\StandReconstruction\\\\work\\\\data\\\\plotBiomHa.csv\")\n\ndf49npp <- fread(\"C:\\\\Celine\\\\Syndocs\\\\RES_Work\\\\Work\\\\StandReconstruction\\\\Juha\\\\data\\\\calculatedFluxes\\\\DF49Tower_FinalCBMResults.csv\")\n\n\n```\n\ntreeDf49 is tree level and may not be useful for this analysis. plotDF49 is as it has annual increment density and dominant species. df49npp is the calculated NPP from the stand reconstruction procedure.\n\n## BAP Landsat values\n\nI obtained Best Available Pixel reflectance values from Joanne White for all the SR sites. These are in wide format and needed to the change to long format. The standRecUTMs.csv can be used to link the UTMs in the BAP to the site names. From the BAP the NBR can be calculated.\n\n```{r, echo=FALSE, eval=FALSE}\n\nbap <- fread(\"G:/RES_Work/Work/StandReconstruction/work/data/whitejoannenrcanrncanrebapproxyvaluesforintens/CB_plots_BAP_July292016.csv\")\n\nhead(bap)\n\n\n\n```\n\n\n\n\n\n\n\n",
    "created" : 1481067585990.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2339467722",
    "id" : "A2FA044",
    "lastKnownWriteTime" : 1488394760,
    "last_content_update" : 1488394760197,
    "path" : "C:/Celine/GitHub/R_collaboration/analysis1dataSteps.Rmd",
    "project_path" : "analysis1dataSteps.Rmd",
    "properties" : {
        "last_setup_crc32" : "AEB80A78c4e2d899",
        "tempName" : "Untitled1"
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}